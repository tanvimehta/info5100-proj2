<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<link rel="stylesheet"
	href="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css">
<style>
body {
	width: 1200px;
	margin: 100px auto;
	font: 10px sans-serif;
	opacity: 0.8;
}

p {
	font-family: 'Raleway', sans-serif;
	font-size: 18px;
}

h1 {
	color: #1A202C;
}

h2 {
	color: #1F7872;
}

svg {
	background-color: #EEE;
	margin: 10px;
}

svg text {
	font-size: 12px;
	margin: 100px auto;
}

rect {
	shape-rendering: crispEdges;
}

.axis path, .axis line {
	fill: none;
	stroke: #000;
	shape-rendering: crispEdges;
}

.bar {
	fill: steelblue;
}

.x.axis path {
	display: none;
}

.imgClass {
	max-width: 100%;
	height: auto;
}

#logoSVG {
	margin: 0 auto;
	display: block;
}

#bullet {
	font-family: "Helvetica Neue", Helvetica, Arial, sans-serif;
	margin: auto;
	padding-top: 40px;
	position: relative;
	width: 960px;
}

button {
	position: absolute;
	right: 10px;
	top: 10px;
}

.svgBgColor {
	background-color: #eee;
}

.bullet {
	font: 10px sans-serif;
}

.bullet .marker {
	stroke: #000;
	stroke-width: 2px;
}

.bullet .tick line {
	stroke: #666;
	stroke-width: .5px;
}

.bullet .range.s0 {
	opacity: 0.3;
}

.bullet .range.s1 {
	opacity: 0.7;
}

.bullet .range.s2 {
	opacity: 1;
}

.bullet .measure.s0 {
	opacity: 0.7;
}

.bullet .measure.s1 {
	opacity: 1;
}

.bullet .title {
	font-size: 14px;
	font-weight: bold;
}

.bullet .subtitle {
	fill: #999;
}

.degree {
	font-size: 11px;
	fill: #404048;
}

#logo .tooltip {
	position: absolute;
	text-align: center;
	width: 80px;
	height: 20px;
	padding: 2px;
	font: 12px sans-serif;
	background: #bdbdbd;
	border: 0px;
	border-radius: 8px;
	pointer-events: none;
	display: inline;
}

.outerDiv {
	position: relative;
}

.alignClass {
	display: inline;
}

.headerClass {
	font-size: 15pt;
	text-align: center;
	font-weight: bold;
	color: black;
}

.d3-tip {
	line-height: 1;
	font-weight: bold;
	padding: 12px;
	background: rgba(0, 0, 0, 0.8);
	color: #fff;
	border-radius: 2px;
}

/* Creates a small triangle extender for the tooltip */
.d3-tip:after {
	box-sizing: border-box;
	display: inline;
	font-size: 10px;
	width: 100%;
	line-height: 1;
	color: rgba(0, 0, 0, 0.8);
	content: "\25BC";
	position: absolute;
	text-align: center;
}

/* Style northward tooltips differently */
.d3-tip.n:after {
	margin: -1px 0 0 0;
	top: 100%;
	left: 0;
}

.buttonSelected {
	background-color: #1F7872; /* Green */
	border: none;
	color: white;
	padding: 15px 32px;
	text-align: center;
	text-decoration: none;
	display: inline-block;
	font-size: 14px;
	margin: 5px;
}

.buttonUnselected {
	border: none;
	background-color: #AAA; /* Gray */
	color: white;
	padding: 15px 32px;
	text-align: center;
	text-decoration: none;
	display: inline-block;
	font-size: 14px;
	margin: 5px;
}
</style>
</head>
<body>
	<h1>Diversity in the Technology Industry</h1>
	<h2>Diversity in Companies</h2>
	<p>Text goes here. Text goes here. Text goes here. Text goes here.
		Text goes here. Text goes here. Text goes here. Text goes here. Text
		goes here. Text goes here. Text goes here. Text goes here. Text goes
		here. Text goes here. Text goes here. Text goes here. Text goes here.
	</p>
	<br>
	<br>
	<br>
	<br>
	<br>
	<script src="http://d3js.org/d3.v3.min.js"></script>
	<script
		src="http://labratrevenge.com/d3-tip/javascripts/d3.tip.v0.6.3.js"></script>
	<script src="js/biPartite.js"></script>
	<script type="text/javascript" src="js/companyInfo.js"></script>
	<script src="data/logos.json"></script>
	<script type="text/javascript" src="data/data.js"></script>
	<script src="js/companyInfo.js"></script>

	<script>
	logoName = "US";
	ethnicData = {};
	</script>
	<div>
		<!-- Visualization 1 -->
		<table>
			<tr>
				<td>
					<div id="idCompanies" class="svgBgColor"
						style="height: 600px; border: 1px solid; align-content: center;"></div>
				</td>

				<td>

					<div class="svgBgColor" id="moreInfo"
						style="height: 600px; width: 600px; border: 1px solid; align-content: center;">
						<div class="headerClass" id="moreInfoHeader">
							<br>US Population vs Employees
						</div>
						<div id="logo" class="outerDiv">
							<div id="logoSVG" style="height: 100px; width: 500px;"></div>
							<div id="bullet" style="height: 400px; width: 500px;"></div>
							<div id="bulletLegend" style="height: 100px; width: 500px;"></div>
						</div>
					</div>

				</td>
			</tr>
		</table>
	</div>

	<br>
	<br>
	<br>
	<br>
	<br>
	<br>
	<h2>Diversity in School</h2>
	<p>Text goes here. Text goes here. Text goes here. Text goes here.
		Text goes here. Text goes here. Text goes here. Text goes here. Text
		goes here. Text goes here. Text goes here. Text goes here. Text goes
		here. Text goes here. Text goes here. Text goes here. Text goes here.
	</p>
	<div id="barchart">
		<span id="breakdown-bar"
			style="font-size: 12pt; padding-top: 40px; display: inline-block;">
			Category: <input id="gender-button" type="button" value="Gender"
			onclick="categoryGender()" /> <input id="ethnicity-button"
			type="button" value="Ethnicity" onclick="categoryEthnicity()" />
			Select one or more from:
		</span>
	</div>

	<script>

var width = 600, height = 530, margin = {
	b : 0,
	t : 40,
	l : 170,
	r : 50
};
var svg = d3.select("#idCompanies").append("svg").attr('width', width)
.attr('height', (height + margin.b + margin.t)).append("g")
.attr("transform",
	"translate(" + margin.l + "," + margin.t + ")");

var data = [ {
	data : bP.partData(company_ethnic_data, 2),
	id : 'TechDiversity',
	header : [ "Company", "Ethnicity", "Diversity in Tech Companies" ]
}, ];

bP.draw(data, svg);

</script>

	<!-- Visualization 2 -->
	<script>
var margin = {
	top : 40,
	right : 50,
	bottom : 90,
	left : 40
}, width = 1160 - margin.left - margin.right, height = 500 - margin.top
- margin.bottom;

var education_levels = 4;

var x = d3.scale.ordinal().rangeRoundBands([ 0, width - margin.right], .1);

		var band_width = width / 5; // number of years

		var y = d3.scale.linear().rangeRound([ height, 0 ]);

		var ethnicities = ["White", "Asian", "Latino", "Black", "Other"];
		var genders = ["Male", "Female"];
		var color = d3.scale.ordinal()
		.domain(ethnicities.concat(genders))
		.range(["#e41a1c", "#377eb8", "#4daf4a", "#984ea3", "#a65628", "#2980b9", "#e7298a"]);

		var xAxis = d3.svg.axis().scale(x).orient("bottom");

		var yAxis = d3.svg.axis().scale(y).orient("left").tickFormat(
			d3.format(".2s"));

		var svg = d3.select("body").append("svg").attr("width",
			width + margin.left + margin.right).attr("height",
			height + margin.top + margin.bottom + 100).append("g").attr(
			"transform",
			"translate(" + margin.left + "," + margin.top + ")").attr("display", "block");



			var category = "Ethnicity";
			var selection = ethnicities.map(function (d) { return {name:d, sel:true}; });

			var tip = d3.tip()
			.attr('class', 'd3-tip')
			.offset([-10, 0])
			.html(function(d) {
				var percentage = d.y1-d.y0;
				return "<strong>"+ d.name + ":</strong> <span style='color:white'>" + d3.format(",")(d3.round(d.val, 0)) + "</br>" 
				+ "</span><strong>Percentage:</strong> <span style='color:white'>" + d3.round(percentage, 2) + "</span>";
			})
			svg.call(tip);

			function categoryGender() {
				category = "Gender"; 
				selection = genders.map(function (d) { return {name:d, sel:true}; });
				displayGenderButtons();
				updateBarChart();
			}

			function categoryEthnicity() {
				category = "Ethnicity"; 
				selection = ethnicities.map(function (d) { return {name:d, sel:true}; });
				displayEthnicityButtons();
				updateBarChart();
			}

			function updateBarChart() {
				updateButtonAppearance();
				var labels = selection
				.filter(function (d) { return d.sel; })
				.map(function (d) { return d.name; });
				draw(labels);
			}

			function toggleButton(d) {
				var idx = selection.map(function (d) { return d.name; }).indexOf(d);
				selection[idx].sel = !selection[idx].sel;
				if (selection.filter(function (d) { return d.sel; }).length < 1) {
					selection[idx].sel = !selection[idx].sel;
					return;
				}

				updateBarChart();
			}

			function updateButtonAppearance() {
				if (category == "Ethnicity") {
					d3.select('#ethnicity-button')
					.attr('class', 'buttonSelected');
					d3.select('#gender-button')
					.attr('class', 'buttonUnselected');
				}
				else {
					d3.select('#gender-button')
					.attr('class', 'buttonSelected');
					d3.select('#ethnicity-button')
					.attr('class', 'buttonUnselected');
				}
				for (var i = 0; i < selection.length; i++) {
					var id = "#" +selection[i].name + "-button";
					if (selection[i].sel) {
						d3.select(id).attr("class", "buttonSelected");
						d3.select(id).style("background-color", color(selection[i].name));
					}
					else {
						d3.select(id).attr("class", "buttonUnselected");
						d3.select(id).style("background-color", "#AAA");
					}
				}
			}

			function displayGenderButtons() {
				var span = d3.select('#breakdown-bar');
				for (var i = 0; i < ethnicities.length; i++) {
					var id = "#" + ethnicities[i] + "-button";
					d3.select(id).remove();
				}
				for (var i = 0; i < genders.length; i++) {
					var id = "#" + genders[i] + "-button";
					d3.select(id).remove();
				}
				span.selectAll(".breakdown-button")
				.data(genders).enter()
				.append("input")
				.attr("type", "button")
				.attr("class", "breakdown-button")
				.attr("id", function(d) { return d + "-button"; })
				.attr("value", function(d) { return d; })
				.on("click", toggleButton);
			}

			function displayEthnicityButtons() {
				var span = d3.select('#breakdown-bar');
				for (var i = 0; i < ethnicities.length; i++) {
					var id = "#" + ethnicities[i] + "-button";
					d3.select(id).remove();
				}
				for (var i = 0; i < genders.length; i++) {
					var id = "#" + genders[i] + "-button";
					d3.select(id).remove();
				}
				span.selectAll(".breakdown-button")
				.data(ethnicities).enter()
				.append("input")
				.attr("type", "button")
				.attr("class", "breakdown-button")
				.attr("id", function(d) { return d + "-button"; })
				.attr("value", function(d) { return d; })
				.on("click", toggleButton);
			}

			var transAP = [];
			var transUGrad = [];
			var transMasters = [];
			var transPhd = [];
			d3.csv("Data/ap-stats.csv", function(error, ap_data) {
				d3.csv("Data/ugrad-stats.csv", function(error1, u_data) {
					d3.csv("Data/masters-stats.csv", function(error2, m_data) {
						d3.csv("Data/phd-stats.csv", function(error3, p_data) {

							if(error)
								throw error;
							if (error1)
								throw error1;
							if (error2)
								throw error2;
							if (error3)
								throw error3;

							var percentagify = function (d) {
								return {
									Year : d.Year,
									Asian : 100 * d.Asian / d.Total,
									Black : 100 * d.Black / d.Total,
									Latino : 100 * d.Latino / d.Total,
									White : 100 * d.White / d.Total,
									Other : 100 * d.Other / d.Total,
									Male : 100 * d.Male / d.Total,
									Female : 100 * d.Female / d.Total,
									NotReported : 100 * d.NotReported / d.Total,
									Total : d.Total
								};
							};
							transAP = ap_data.map(percentagify);
							transUGrad = u_data.map(percentagify);
							transMasters = m_data.map(percentagify);
							transPhd = p_data.map(percentagify);

							// color.domain(d3.keys(u_data[0]).filter(function(key) {
							// 	return key !== "Year" && key !== "Total";
							// }));

ap_data.forEach(function(d) {
	var y0 = 0;
	d.races = color.domain().map(function(name) {
		return {
			name : name,
			y0 : y0,
			y1 : y0 += +((d[name]/d["Total"])*100),
			val : d[name]
		};
	});
	d.total = d.races[d.races.length - 1].y1;
});

u_data.forEach(function(d) {
	var y0 = 0;
	d.races = color.domain().map(function(name) {
		return {
			name : name,
			y0 : y0,
			y1 : y0 += +((d[name]/d["Total"])*100),
			val : d[name]
		};
	});
	d.total = d.races[d.races.length - 1].y1;
});

m_data.forEach(function(d) {
	var y0 = 0;
	d.races = color.domain().map(function(name) {
		return {
			name : name,
			y0 : y0,
			y1 : y0 += +((d[name]/d["Total"])*100),
			val : d[name]
		};
	});
	d.total = d.races[d.races.length - 1].y1;
});

p_data.forEach(function(d) {
	var y0 = 0;
	d.races = color.domain().map(function(name) {
		return {
			name : name,
			y0 : y0,
			y1 : y0 += +((d[name]/d["Total"])*100),
			val : d[name]
		};
	});
	d.total = d.races[d.races.length - 1].y1;
});

ap_data.sort(function(a, b) {
	return a.Year - b.Year;
});
u_data.sort(function(a, b) {
	return a.Year - b.Year;
});
m_data.sort(function(a, b) {
	return a.Year - b.Year;
});
p_data.sort(function(a, b) {
	return a.Year - b.Year;
});

x.domain(u_data.map(function(d) {
	return d.Year;
}));
y.domain([ 0, 100 ]);

svg.append("g").attr("class", "x axis").attr(
	"transform",
	"translate(0," + (height + 50) + ")").call(
	xAxis);

	svg.append("g").attr("class", "y axis").call(yAxis);

	var ap = svg.selectAll(".ap").data(ap_data).enter()
	.append("g").attr("class", "g").attr(
		"transform",
		function(d) {
			return "translate(" + x(d.Year)
				+ ",0)";
});

	var ugrad = svg.selectAll(".ugrad").data(u_data)
	.enter().append("g").attr("class", "g").attr(
		"transform",
		function(d) {
			return "translate(" + x(d.Year)
				+ ",0)";
});
	var masters = svg.selectAll(".masters").data(m_data)
	.enter().append("g").attr("class", "g").attr(
		"transform",
		function(d) {
			return "translate(" + x(d.Year)
				+ ",0)";
});
	var phd = svg.selectAll(".phd").data(p_data).enter()
	.append("g").attr("class", "g").attr(
		"transform",
		function(d) {
			return "translate(" + x(d.Year)
				+ ",0)";
});

	ap.selectAll("rect").data(function(d) {
		return d.races;
	}).enter().append("rect").attr("width",
	x.rangeBand() / education_levels - 6).attr("y",
	function(d) {
		return y(d.y1);
	}).attr("opacity", 0).attr("height", function(d) {
		return y(d.y0) - y(d.y1);
	}).attr("class", "advp").style("fill", function(d) {
		return color(d.name);
	});

	ugrad.selectAll("rect").data(function(d) {
		return d.races;
	}).enter().append("rect").attr("width",
	x.rangeBand() / education_levels - 6).attr("y",
	function(d) {
		return y(d.y1);
	}).attr("opacity", 0).attr("height", function(d) {
		return y(d.y0) - y(d.y1);
	}).attr(
	"transform",
	function(d) {
		return "translate(" + x.rangeBand()/ education_levels + ",0)";
	}).attr("class", "undergrad").style("fill",
	function(d) {
		return color(d.name);
	});
	masters.selectAll("rect").data(function(d) {
		return d.races;
	}).enter().append("rect").attr("width",
	x.rangeBand() / education_levels - 6).attr("y",
	function(d) {
		return y(d.y1);
	}).attr("opacity", 0).attr("height", function(d) {
		return y(d.y0) - y(d.y1);
	}).attr(
	"transform",
	function(d) {
		return "translate(" + 2 * x.rangeBand()/ education_levels + ",0)";
	}).attr("class", "mas").style("fill",
	function(d) {
		return color(d.name);
	});
	phd.selectAll("rect").data(function(d) {
		return d.races;
	}).enter().append("rect").attr("width",
	x.rangeBand() / education_levels - 6).attr("y",
	function(d) {
		return y(d.y1);
	}).attr("opacity", 0).attr("height", function(d) {
		return y(d.y0) - y(d.y1);
	}).attr(
	"transform",
	function(d) {
		return "translate(" + 3 * x.rangeBand()/ education_levels + ",0)";
	}).attr("class", "pd").style("fill",
	function(d) {
		return color(d.name);
	});

	ap.selectAll("rect").on('mouseover', tip.show).on('mouseout', tip.hide);
	ugrad.selectAll("rect").on('mouseover', tip.show).on('mouseout', tip.hide);
	masters.selectAll("rect").on('mouseover', tip.show).on('mouseout', tip.hide);
	phd.selectAll("rect").on('mouseover', tip.show).on('mouseout', tip.hide);

	ap.append("text").attr("y", function(d) {
		return y(0) + 20;
	}).attr("class", "degree").attr(
	"transform",
	function(d) {
		return "translate(" + -290 + "," + 143
			+ ") rotate(-45)";
}).text("High School");

	ugrad.append("text").attr("y", function(d) {
		return y(0) + 20;
	}).attr("class", "degree").attr(
	"transform",
	function(d) {
		return "translate("
			+ (1 * x.rangeBand()/ education_levels - 290)
			+ "," + 140 + ") rotate(-45)";}).text("Undergrad");

	masters.append("text").attr("y", function(d) {
		return y(0) + 20;
	}).attr("class", "degree").attr(
	"transform",
	function(d) {
		return "translate("
			+ (2 * x.rangeBand()/ education_levels - 280)
			+ "," + 130 + ") rotate(-45)";
}).text("Masters");

	phd.append("text").attr("y", function(d) {
		return y(0) + 20;
	}).attr("class", "degree").attr(
	"transform",
	function(d) {
		return "translate("
			+ (3 * x.rangeBand()/ education_levels - 270)
			+ "," + 120 + ") rotate(-45)";
}).text("PhD");

	draw(ethnicities);
});
});
});
});

	// the visualization starts with a breakdown by ethnicity
	categoryEthnicity();

		//http://stackoverflow.com/questions/281264/remove-empty-elements-from-an-array-in-javascript
		Array.prototype.clean = function(deleteValue) {
			for (var i = 0; i < this.length; i++) {
				if (this[i] == deleteValue) {
					this.splice(i, 1);
					i--;
				}
			}
			return this;
		};

		function draw(labels) {
			transAP.forEach(function(d) {
				var y0 = 0;
				d.races = color.domain().slice().reverse().map(function(name) {
					if (labels.indexOf(name) > -1) {
						console.log(d);
						return {
							name : name,
							y0 : y0,
							y1 : y0 += +d[name],
							val : d[name]*d["Total"]*0.01
						}
					} else {
						return;
					}
					;
				});
				d.races.clean(undefined);
				if (d.races.length > 0)
					d.total = d.races[d.races.length - 1].y1;
				else
					d.total = 0;
			});

			transUGrad.forEach(function(d) {
				var y0 = 0;
				d.races = color.domain().slice().reverse().map(function(name) {
					if (labels.indexOf(name) > -1) {
						return {
							name : name,
							y0 : y0,
							y1 : y0 += +d[name],
							val : d[name]*d["Total"]*0.01
						}
					} else {
						return;
					}
					;
				});
				d.races.clean(undefined);
				if (d.races.length > 0)
					d.total = d.races[d.races.length - 1].y1;
				else
					d.total = 0;
			});

			transMasters.forEach(function(d) {
				var y0 = 0;
				d.races = color.domain().slice().reverse().map(function(name) {
					if (labels.indexOf(name) > -1) {
						return {
							name : name,
							y0 : y0,
							y1 : y0 += +d[name],
							val : d[name]*d["Total"]*0.01
						}
					} else {
						return;
					}
					;
				});
				d.races.clean(undefined);
				if (d.races.length > 0)
					d.total = d.races[d.races.length - 1].y1;
				else
					d.total = 0;
			});

			transPhd.forEach(function(d) {
				var y0 = 0;
				d.races = color.domain().slice().reverse().map(function(name) {
					if (labels.indexOf(name) > -1) {
						return {
							name : name,
							y0 : y0,
							y1 : y0 += +d[name],
							val : d[name]*d["Total"]*0.01
						}
					} else {
						return;
					}
					;
				});
				d.races.clean(undefined);
				if (d.races.length > 0)
					d.total = d.races[d.races.length - 1].y1;
				else
					d.total = 0;
			});

			d3.selectAll(".undergrad").transition().remove();
			d3.selectAll(".mas").transition().remove();
			d3.selectAll(".pd").transition().remove();
			d3.selectAll(".advp").transition().remove();

			var ap = svg.selectAll(".ap").data(transAP).enter().append("g")
			.attr("class", "g").attr("transform", function(d) {
				return "translate(" + x(d.Year) + ",0)";
			});

			var ugrad = svg.selectAll(".ugrad").data(transUGrad).enter()
			.append("g").attr("class", "g").attr("transform",
				function(d) {
					return "translate(" + x(d.Year) + ",0)";
				});

			var masters = svg.selectAll(".masters").data(transMasters).enter()
			.append("g").attr("class", "g").attr("transform",
				function(d) {
					return "translate(" + x(d.Year) + ",0)";
				});

			var phd = svg.selectAll(".phd").data(transPhd).enter().append("g")
			.attr("class", "g").attr("transform", function(d) {
				return "translate(" + x(d.Year) + ",0)";
			});

			ap.selectAll("rect").data(function(d) {
				return d.races;
			}).enter().append("rect").transition().attr("width",
			x.rangeBand() / education_levels - 6).attr("y",
			function(d) {
				return y(d.y1);
			}).transition().attr("height", function(d) {
				return y(d.y0) - y(d.y1);
			}).attr("class", "advp").style("fill", function(d) {
				return color(d.name);
			});

			ugrad.selectAll("rect").data(function(d) {
				return d.races;
			}).enter().append("rect").transition().attr("width",
			x.rangeBand() / education_levels - 6).attr("y",
			function(d) {
				return y(d.y1);
			}).transition().attr("height", function(d) {
				return y(d.y0) - y(d.y1);
			}).attr("transform", function(d) {
				return "translate(" + x.rangeBand() / education_levels + ",0)";
			}).attr("class", "undergrad").style("fill", function(d) {
				return color(d.name);
			});

			masters.selectAll("rect").data(function(d) {
				return d.races;
			}).enter().append("rect").transition().attr("width",
			x.rangeBand() / education_levels - 6).attr("y",
			function(d) {
				return y(d.y1);
			}).transition().attr("height", function(d) {
				return y(d.y0) - y(d.y1);
			}).attr(
			"transform",
			function(d) {
				return "translate(" + 2 * x.rangeBand() / education_levels + ",0)";
			}).attr("class", "mas").style("fill", function(d) {
				return color(d.name);
			});

			phd.selectAll("rect").data(function(d) {
				return d.races;
			}).enter().append("rect").transition().attr("width",
			x.rangeBand() / education_levels - 6).attr("y",
			function(d) {
				return y(d.y1);
			}).transition().attr("height", function(d) {
				return y(d.y0) - y(d.y1);
			}).attr(
			"transform",
			function(d) {
				return "translate(" + 3 * x.rangeBand() / education_levels + ",0)";
			}).attr("class", "pd").style("fill", function(d) {
				return color(d.name);
			});

			ap.selectAll("rect").on('mouseover', tip.show).on('mouseout', tip.hide);
			ugrad.selectAll("rect").on('mouseover', tip.show).on('mouseout', tip.hide);
			masters.selectAll("rect").on('mouseover', tip.show).on('mouseout', tip.hide);
			phd.selectAll("rect").on('mouseover', tip.show).on('mouseout', tip.hide);

		}
		</script>
</body>
</html>
